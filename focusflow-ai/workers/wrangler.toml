name = "focusflow-api"
main = "src/index.ts"
compatibility_date = "2024-02-01"

# Environment Variables (use `wrangler secret put` for sensitive values)
[vars]
ENVIRONMENT = "development"
CLERK_PUBLISHABLE_KEY = "pk_test_..." # Your Clerk publishable key
REVENUECAT_PUBLIC_API_KEY = "..." # Your RevenueCat public API key
GEMINI_API_KEY = "..." # Your Gemini API key

# Secrets (set via wrangler secret put)
# CLERK_SECRET_KEY
# REVENUECAT_SECRET_API_KEY
# R2_ACCESS_KEY_ID
# R2_SECRET_ACCESS_KEY

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "focusflow-db"
database_id = "your-database-id-here"

# R2 Storage Buckets
[[r2_buckets]]
binding = "AVATARS_BUCKET"
bucket_name = "focusflow-avatars"

[[r2_buckets]]
binding = "ATTACHMENTS_BUCKET"
bucket_name = "focusflow-attachments"

# KV Namespaces (for caching, sessions)
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"

# Queue for background jobs
[[queues.producers]]
binding = "NOTIFICATION_QUEUE"
queue = "focusflow-notifications"

[[queues.consumers]]
queue = "focusflow-notifications"
max_batch_size = 10
max_batch_timeout = 5

# Analytics Engine
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "focusflow-analytics"

# Scheduled Jobs (cron triggers)
[triggers]
crons = ["0 6 * * *", "0 */4 * * *"] # Daily at 6 AM, every 4 hours

# Environment-specific settings
[env.staging]
name = "focusflow-api-staging"
[env.staging.vars]
ENVIRONMENT = "staging"

[env.production]
name = "focusflow-api"
[env.production.vars]
ENVIRONMENT = "production"

[env.production.triggers]
crons = ["0 6 * * *", "0 */4 * * *", "0 0 * * 0"] # Daily, every 4h, weekly on Sunday
